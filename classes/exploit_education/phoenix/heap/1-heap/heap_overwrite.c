/*
 * phoenix/heap-zero, by https://exploit.education
 *
 * Can you hijack flow control?
 *
 * Which vegetable did Noah leave off the Ark?
 * Leeks
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

#define BANNER "Welcome to heap-one, brought to you by https://exploit.education"

struct heapStructure {
  int priority;
  char *name;
};

int main(int argc, char **argv) {
  struct heapStructure *i1, *i2;

    if (argc < 3) {
    printf("Please specify arguments to copy :-)\n");
    exit(1);
  }

  // Malloc returns allocation address to EAX and $ebp-0x1c, [breakpoint]
  i1 = malloc(sizeof(struct heapStructure));
  i1->priority = 1;
  i1->name = malloc(8);

  // Malloc returns allocation address to EAX and $ebp-0x20 [breakpoint]
  i2 = malloc(sizeof(struct heapStructure));
  i2->priority = 2;
  i2->name = malloc(8);

  // We can use first arg to provide an address to write to (got.puts)
  strcpy(i1->name, argv[1]);
  // Second arg the address we want to write (winner)
  strcpy(i2->name, argv[2]);

  // Note that compiler will replace printf() with puts()
  // We want to overwrite got.puts() with winner()
  printf("and that's a wrap folks!\n");
}

void winner() {
  printf(
      "Congratulations, you've completed this level @ %ld seconds past the "
      "Epoch\n",
      time(NULL));
}